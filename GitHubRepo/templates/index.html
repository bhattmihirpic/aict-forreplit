{% extends "base.html" %}
{% block title %}Upload Document - Academic Integrity Tool{% endblock %}
{% block content %}
<div class="container py-4">
  <h1 class="mb-4">ðŸ“‚ Upload Documents</h1>

  <form method="POST" enctype="multipart/form-data">
    {{ form.hidden_tag() }}
    <div class="mb-3">
      <label for="assignment_name" class="form-label">Assignment Name</label>
      {{ form.assignment_name(class="form-control", id="assignment_name", placeholder="e.g., Week 3 Essays") }}
    </div>

    <div class="card mb-4">
      <div class="card-header"><strong>Upload</strong></div>
      <div class="card-body text-center">
        <input type="file"
               name="file"
               id="upload_files"
               multiple
               class="form-control"
               accept=".pdf,.docx,.txt"
               style="height:auto;" />
        <div class="small text-muted mt-2">
          You may select one or up to 150 files (PDF/DOCX/TXT) â€” Max 32 MB each
        </div>
      </div>
      <div class="card-footer text-center">
        <button type="submit" class="btn btn-primary">ðŸ“¦ Upload & Analyze</button>
      </div>
    </div>
  </form>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-3">
        {% for category, msg in messages %}
          <div class="alert alert-{{ 'danger' if category=='error' else category }}">
            {{ msg }}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <h2 class="mt-5">Recent Analyses</h2>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Document</th>
        <th>Date</th>
        <th>Plagiarism</th>
        <th>AI Score</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody>
      {% for analysis in recent_analyses %}
        <tr>
          <td>{{ analysis.filename[:25] }}{% if analysis.filename|length > 25 %}â€¦{% endif %}</td>
          <td>{{ analysis.timestamp.strftime('%m/%d %H:%M') }}</td>
          <td>{{ "%.0f"|format(analysis.plagiarism_score) }}%</td>
          <td>{{ "%.0f"|format(analysis.ai_score) }}%</td>
          <td>
            <a href="{{ url_for('show_results', analysis_id=analysis.analysis_id) }}"
               class="btn btn-sm btn-outline-primary">View</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<style>
.upload-box {
  display: block;
  cursor: pointer;
  padding: 2rem;
  border: 2px dashed #ccc;
  border-radius: 8px;
}
.upload-box:hover {
  background-color: #f8f9fa;
}
</style>
{% endblock %}